<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Sandi's Book Club</title>
<style>
    :root { --gold: #af8c4b; }
    body { font-family: Georgia, sans-serif; background-color: #fffbf2; color: #5d4a27; margin: 0; padding-bottom: 70px; }
    
    /* 1. NIERUCHOMA NAWIGACJA Z DWOMA LINIAMI */
    nav { 
        background: white; 
        padding: 60px 0; 
        display: flex; 
        justify-content: center; 
        align-items: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
        position: fixed; 
        top: 0; 
        left: 0;
        width: 100%;
        z-index: 2000; 
        border-top: 3px solid var(--gold); 
        border-bottom: 3px solid var(--gold); 
    }
    
    .nav-links { display: flex; gap: 40px; align-items: center; }
    .nav-links a { 
        text-decoration: none; color: #5d4a27; font-weight: bold; text-transform: uppercase; 
        font-size: 0.9em; letter-spacing: 1px; transition: 0.3s; padding-bottom: 5px; 
    }
    .nav-links a:hover { color: #af8c4b; }
    .special-link { color: #af8c4b !important; border-bottom: 2px solid #af8c4b; }

    /* 2. NIERUCHOMY PASEK LOGOWANIA */
    .login-status-bar {
        background: #fdf2d5; 
        text-align: center; 
        padding: 20px; 
        font-size: 1.1em; 
        border-bottom: 3px solid var(--gold);
        position: fixed; 
        top: 141px; 
        left: 0;
        width: 100%;
        z-index: 1999;
    }

    /* 3. MARGINES TRE≈öCI */
    .container { 
        max-width: 1100px; 
        margin: auto; 
        padding: 20px; 
        margin-top: 240px; 
    }
    
    .book-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 30px; margin-top: 30px; }
    .card { 
        background: white; padding: 12px; border-radius: 10px; border-bottom: 5px solid var(--gold); 
        cursor: pointer; transition: 0.3s; box-shadow: 0 4px 8px rgba(0,0,0,0.1); width: 200px; text-align: center; 
    }
    .card:hover { transform: scale(1.02); background: #fef9e7; }
    .card img { width: 100%; height: 280px; object-fit: cover; border-radius: 5px; filter: sepia(0.1); transition: 0.3s; }
    .card h3 { font-size: 1em; margin: 10px 0 5px 0; color: #5d4a27; }
    .card p { font-size: 0.85em; margin: 0; opacity: 0.8; }

    /* MODAL */
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 3000; align-items: center; justify-content: center; }
    .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative; }
    .close { position: absolute; right: 20px; top: 10px; font-size: 30px; cursor: pointer; color: var(--gold); }

    footer { 
        position: fixed; bottom: 0; width: 100%; background-color: #677b89; color: #faca83; 
        text-align: center; padding: 15px 0; font-size: 0.9em; border-top: 3px solid var(--gold); 
        z-index: 2000;
    }
</style>
</head>
<body>

<nav>
    <div class="nav-links">
        <a href="{{ url_for('index') }}" class="{{ 'special-link' if request.endpoint == 'index' }}">G≈Ç√≥wna</a>
        <a href="{{ url_for('about') }}" class="{{ 'special-link' if request.endpoint == 'about' }}">O mnie</a>
        <a href="{{ url_for('contact') }}" class="{{ 'special-link' if request.endpoint == 'contact' }}">Kontakt</a>
        {% if session.get('user') %}
            <a href="{{ url_for('forum') }}" class="{{ 'special-link' if request.endpoint == 'forum' }}">Forum</a>
            <a href="{{ url_for('dashboard') }}" class="{{ 'special-link' if request.endpoint == 'dashboard' }}">Panel</a>
            <a href="{{ url_for('logout') }}">Wyloguj</a>
        {% else %}
            <a href="{{ url_for('login') }}">Logowanie</a>
        {% endif %}
    </div>
</nav>

{% if session.get('user') %}
<div class="login-status-bar">
    Jeste≈õ zalogowany jako <strong>{{ session['user'] }}</strong>
</div>
{% endif %}

<div class="container">
    {% block content %}{% endblock %}
</div>

<div id="bookModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <div style="display:flex; gap:20px; flex-wrap: wrap;">
            <img id="modalImg" style="width:180px; border-radius:10px; object-fit: cover;">
            <div style="flex: 1; min-width: 250px;">
                <h2 id="modalTitle" style="color:var(--gold); margin-top: 0;"></h2>
                <strong id="modalAuthor"></strong>
                <div id="modalDesc" style="margin-top: 15px; line-height: 1.6;"></div>
                <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                <div id="modalComments"></div>
            </div>
        </div>
    </div>
</div>

<footer><strong>Sandi's Book Club</strong> ¬© 2026</footer>

<script>
function openModal(title, author, desc, img) {
    // 1. Ustawienie podstawowych danych
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalAuthor').textContent = author;
    document.getElementById('modalDesc').innerHTML = desc;
    document.getElementById('modalImg').src = img;

    // 2. Pobieranie opinii - bezpieczne parsowanie JSON
    let reviews = [];
    try {
        reviews = {{ reviews | tojson | safe if reviews else '[]' }};
    } catch(e) {
        console.error("B≈ÇƒÖd ≈Çadowania opinii:", e);
    }

    // 3. Filtrowanie i wy≈õwietlanie opinii
    const filtered = reviews.filter(r => r.book === title);
    const commentsContainer = document.getElementById('modalComments');
    
    if (commentsContainer) {
        commentsContainer.innerHTML = filtered.length > 0 
            ? filtered.map(r => `
                <div style="background:#f9f9f9; padding:10px; margin-bottom:8px; border-left:3px solid var(--gold); border-radius:5px;">
                    <strong style="font-size:0.9em; color:#5d4a27;">${r.user}:</strong> 
                    <p style="margin:5px 0 0 0; font-size:0.85em; font-style:italic;">"${r.text}"</p>
                </div>`).join('')
            : '<p style="color:#999; font-size:0.85em; font-style:italic;">Brak opinii klubowicz√≥w o tej pozycji.</p>';
    }

    // 4. Pokazanie okna
    document.getElementById('bookModal').style.display = "flex";
}

function closeModal() { 
    document.getElementById('bookModal').style.display = "none"; 
}

// Zamykanie przy klikniƒôciu poza okno
window.onclick = function(event) {
    if (event.target == document.getElementById('bookModal')) {
        closeModal();
    }
}

const meetingDate = new Date(2026, 0, 27, 18, 0, 0).getTime();
const countdown = setInterval(function() {
    const now = new Date().getTime();
    const distance = meetingDate - now;
    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
    
    const dEl = document.getElementById("days");
    const hEl = document.getElementById("hours");
    const mEl = document.getElementById("minutes");
    const sEl = document.getElementById("seconds");
    
    if(dEl) dEl.innerText = days.toString().padStart(2, '0');
    if(hEl) hEl.innerText = hours.toString().padStart(2, '0');
    if(mEl) mEl.innerText = minutes.toString().padStart(2, '0');
    if(sEl) sEl.innerText = seconds.toString().padStart(2, '0');
    
    if (distance < 0) {
        clearInterval(countdown);
        const section = document.getElementById("countdown-section");
        if(section) section.innerHTML = "<h2>Spotkanie w≈Ça≈õnie trwa! üïØÔ∏è</h2>";
    }
}, 1000);
</script>
</body>
</html>